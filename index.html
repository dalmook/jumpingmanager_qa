<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#ffffff" />
  <title>점핑배틀 화성병점점</title>

  <link rel="stylesheet" href="styles.css" />

  <!-- Firebase SDK -->
  <script defer src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.13.2/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore-compat.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script defer src="app.js"></script>
</head>
<body class="ios">
  <!-- iOS Large Title Header -->
  <header class="ios-header">
    <div class="safe-pad"></div>

    <div class="header-inner">
      <div class="header-top">
        <div class="brand">
          <span class="logo-dot"></span>
          <span class="brand-text">점핑배틀 화성병점점</span>
        </div>

        <div class="auth-area">
          <!-- 로그아웃 전(비회원/미인증) -->
          <div id="signedOut" class="auth-row">
            <!-- 관리자: 이메일, 손님: 휴대폰 01012345678 -->
            <input id="loginEmail" type="text" inputmode="text" placeholder="휴대폰 01012345678" />
            <input id="loginPass" type="password" placeholder="비밀번호" />
            <button id="btnLogin" class="btn primary">로그인</button>
            <button id="btnSignup" class="btn ghost">회원가입</button>
          </div>

          <!-- 로그인 상태에서만 노출 -->
          <div id="signedIn" class="auth-row hidden">
            <button id="btnLogout" class="btn small ghost logout-top">로그아웃</button>
          </div>
        </div>
      </div>

      <!-- 상단 큰 QR (손님용) -->
      <div id="selfBigQR" class="big-qr"></div>
    </div>
  </header>

  <main class="app-shell">
    <!-- ========================= -->
    <!-- 관리자 화면 -->
    <!-- ========================= -->
    <section id="adminPanel" class="panel hidden">
      <div class="card glass">
        <div class="seg-head">
          <div class="segmented">
            <button class="seg on" type="button" aria-pressed="true">회원</button>
            <button class="seg" type="button" disabled>통계(준비중)</button>
          </div>
          <button id="btnQRScan" class="btn small highlight">QR 스캔</button>
        </div>
      </div>

      <div class="admin-grid">
        <!-- 좌: 목록/검색 -->
        <aside class="card glass stick-left">
          <div class="section-head">
            <h2>회원 목록</h2>
          </div>
          <div class="search-row">
            <input id="searchPhone" placeholder="휴대폰 전체/끝 4자리" inputmode="numeric" />
            <button id="btnSearch" class="btn ghost">검색</button>
            <button id="btnLoadAll" class="btn ghost">전체 100</button>
          </div>

          <div class="quick-register">
            <details>
              <summary>빠른 등록/수정</summary>
              <div class="grid three">
                <input id="regName" placeholder="이름" />
                <input id="regPhone" placeholder="휴대폰번호" inputmode="numeric" />
                <input id="regTeam" placeholder="팀명" />
                <button id="btnRegister" class="btn primary">등록/수정</button>
              </div>
            </details>
          </div>

          <div id="adminList" class="list mt8" aria-live="polite"></div>
        </aside>

        <!-- 우: 상세 -->
        <section id="memberSection" class="card glass hidden">
          <div class="section-head">
            <h2>회원 상세</h2>
          </div>

          <div class="member-card" id="memberCard">
            <div class="member-head">
              <div>
                <div class="m-name">-</div>
                <div id="mTeam" class="muted">팀: -</div>
                <div id="mEmail" class="muted">이메일: -</div>
                <div class="muted" style="font-size:12px">
                  차량: <span id="mCar">-</span> · 비고: <span id="mNote">-</span> · 전화: <span id="mPhone">-</span>
                </div>
              </div>

              <div class="stats">
                <div class="stat pill"><div class="label">스탬프(10)</div><div id="mStamp" class="value">0</div></div>
                <div class="stat pill"><div class="label">무료권</div><div id="mFree" class="value">0</div></div>
                <div class="stat pill"><div class="label">평일무료권</div><div id="mFreeWk" class="value">0</div></div>
                <div class="stat pill"><div class="label">슬러시 무료권</div><div id="mFreeSl" class="value">0</div></div>
                <div class="stat pill"><div class="label">다회권 잔여</div><div id="mPassTotal" class="value">0</div></div>
              </div>
            </div>

            <div class="progress">
              <div id="stampDots" class="dots"></div>
            </div>

            <!-- 기본 정보 -->
            <div class="section-card">
              <div class="section-row">
                <h3>기본 정보</h3>
                <button id="btnSaveProfile" class="btn primary small">프로필 저장</button>
              </div>
              <div class="grid three">
                <label for="editName">이름</label>
                <input id="editName" placeholder="이름" />

                <label for="editTeam">팀명</label>
                <input id="editTeam" placeholder="팀명" />

                <label for="editEmail">이메일</label>
                <input id="editEmail" placeholder="이메일" />  

                <label for="editCar">차량번호</label>
                <input id="editCar" placeholder="차량번호 (선택)" />

                <label for="editNote">비고</label>
                <input id="editNote" placeholder="비고 (선택)" />

                <label>전화번호</label>
                <input disabled value="전화번호는 문서 키 기준" />
              </div>
            </div>

            <!-- 액션: 스탬프/무료권 + 다회권 -->
            <div class="admin-actions">
              <!-- 스탬프/무료권 -->
              <div class="section-card">
                <h3>스탬프 / 무료권</h3>

                <div class="btn-grid mt8">
                  <button id="btnAddVisit" class="btn primary">방문 +1</button>
                  <button id="btnResetStamp" class="btn ghost">스탬프 0</button>
                </div>

                <!-- 스탬프 N 증감 -->
                <div class="input-actions">
                  <div class="ia-row">
                    <label for="stampDelta" class="ia-label">스탬프</label>
                    <input id="stampDelta" type="number" min="1" step="1" value="1" />
                    <div class="ia-buttons">
                      <button id="btnAddStampN" class="btn primary">+N</button>
                      <button id="btnSubStampN" class="btn ghost">-N</button>
                    </div>
                  </div>
                </div>

                <!-- 슬러시 무료권 N 증감 -->
                <div class="input-actions mt8">
                  <div class="ia-row">
                    <label for="freeSlDelta" class="ia-label">슬러시 무료권</label>
                    <input id="freeSlDelta" type="number" min="1" step="1" value="1" />
                    <div class="ia-buttons">
                      <button id="btnAddFreeSlN" class="btn primary">+N</button>
                      <button id="btnSubFreeSlN" class="btn ghost">-N</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 다회권 -->
              <div class="section-card">
                <div class="section-row">
                  <h3>다회권</h3>
                  <div class="row gap8">
                    <button id="passPreset10" class="btn ghost small">10회권</button>
                    <button id="passPreset20" class="btn ghost small">20회권</button>
                    <button id="passPresetFree" class="btn ghost small">무료권</button>
                    <button id="passPresetWk"   class="btn ghost small">평일무료권</button>
                  </div>
                </div>

                <!-- 추가 폼 -->
                <div class="pass-add-grid mt8">
                  <input id="passName"  placeholder="권종명 (예: 10회권, 무료권, 평일무료권)" />
                  <input id="passCount" type="number" min="1" step="1" value="1" />
                  <input id="passExpire" type="date" />
                  <button id="btnAddPass" class="btn primary">권종 추가</button>
                </div>

                <!-- 선택 후 차감/환불/삭제 -->
                <div class="pass-op-grid mt8">
                  <select id="passSelect"></select>
                  <input id="passDelta" type="number" min="1" step="1" value="1" />
                  <div class="row gap8">
                    <button id="btnUsePassN" class="btn">-N</button>
                    <button id="btnRefundPassN" class="btn ghost">+N</button>
                  </div>
                  <button id="btnDeletePass" class="btn danger wFull">선택권 삭제</button>
                </div>
              </div>
            </div>

            <div class="grid two mt16">
              <div class="section-card">
                <h3>보유 다회권</h3>
                <div id="passList" class="list small"></div>
              </div>
              <div class="section-card">
                <h3>스테이지 기록</h3>
                <div id="stageList" class="list small"></div>
                <button id="btnSaveStages" class="btn primary small mt8">스테이지 저장</button>
              </div>
            </div>

            <!-- 위험 작업 -->
            <div class="danger-zone section-card">
              <div class="row wrap gap8">
                <button id="btnDeleteMember" class="btn danger">회원 삭제</button>
                <span class="muted">로그 서브컬렉션은 남습니다</span>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- 플로팅 단축(FAB) -->
      <div class="fab-area">
        <button id="fabAddVisit" class="fab" title="방문 +1"
          onclick="document.getElementById('btnAddVisit')?.click()">＋</button>
      </div>
    </section>

    <!-- ========================= -->
    <!-- 손님 화면 -->
    <!-- ========================= -->
    <section id="memberSelf" class="panel hidden">
      <div class="card ios-card">
        <!-- 탭 콘텐츠 -->
        <div class="self-tabs">
          <div id="selfTab-summary" class="tabpane active">
            <div id="selfCard" class="member-card compact"></div>
          </div>

          <div id="selfTab-passes" class="tabpane">
            <div class="section-card">
              <h3>보유 다회권</h3>
              <div id="selfPassList" class="list small"></div>
            </div>
          </div>

          <div id="selfTab-logs" class="tabpane">
            <div class="section-card">
              <h3>스테이지 기록</h3>
              <button id="btnViewStages" class="btn primary small">기록 보기</button>
              <div id="selfStageList" class="list small mt8"></div>
            </div>
          </div>
        </div>

        <!-- iOS 스타일 탭바 -->
        <nav class="tabbar">
          <button type="button" class="tab on" data-tab="summary">
            <span class="ico">🏠</span><span class="txt">요약</span>
          </button>
          <button type="button" class="tab" data-tab="passes">
            <span class="ico">🎫</span><span class="txt">다회권</span>
          </button>
          <button type="button" class="tab" data-tab="logs">
            <span class="ico">🧾</span><span class="txt">로그</span>
          </button>
        </nav>
      </div>
    </section>
  </main>

  <!-- QR 스캔 모달 -->
  <div id="qrModal" class="qr-modal hidden" role="dialog" aria-modal="true" aria-label="QR 스캔">
    <div class="qr-sheet">
      <video id="qrVideo" autoplay playsinline></video>
      <div class="row gap8 mt8">
        <button id="qrClose" class="btn ghost small">닫기</button>
        <span class="muted" id="qrHint">QR을 화면에 맞춰 주세요</span>
      </div>
    </div>
  </div>
<!-- 회원가입 모달 -->
<div id="signupModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="signupTitle">
  <div class="modal-content card glass">
    <h2 id="signupTitle">회원가입</h2>

    <!-- ✅ 폼이 전부를 감쌉니다 -->
    <form id="signupForm" class="signup-form">
      <div class="grid">
        <input id="suName"  placeholder="이름 (필수)"        required />
        <input id="suPhone" placeholder="휴대폰번호 (필수)" inputmode="numeric" required />
        <input id="suPass"  type="password" placeholder="비밀번호 (필수)" required />
        <input id="suEmail" placeholder="이메일 (선택)" />
        <input id="suTeam"  placeholder="팀명 (선택)" />
        <input id="suCar"   placeholder="차량번호 (선택)" />
      </div>

      <!-- 개인정보 수집·이용 동의 -->
      <div style="grid-column:1 / -1; font-size:12px; line-height:1.5; margin-top:12px;">
        <p><b>개인정보 수집·이용 동의</b></p>
        <p>본 웹앱은 회원 관리와 이용 내역 기록을 위해 아래의 개인정보를 수집·이용합니다.</p>
        <ul style="margin:4px 0 8px 16px; padding:0;">
          <li>수집 항목: 이름, 휴대폰번호, 비밀번호, 이메일, 팀명, (선택) 차량번호</li>
          <li>이용 목적: 회원 식별, 서비스 이용 기록 관리, 무료권/스탬프 적립</li>
          <li>보유 기간: 회원 탈퇴 시 즉시 삭제</li>
        </ul>
        <label style="display:flex; align-items:center; gap:6px;">
          <input id="suAgree" type="checkbox" required />
          개인정보 수집·이용에 동의합니다.
        </label>
      </div>

      <div class="row mt16">
        <!-- ✅ type="submit" 으로 둡니다 -->
        <button id="btnDoSignup" type="submit" class="btn primary">가입하기</button>
        <button id="btnCancelSignup" type="button" class="btn ghost">취소</button>
      </div>
    </form>
  </div>
</div>


  <!-- 디버그 패널 -->
  <button id="__dbgToggle" class="dbg-toggle hidden">디버그</button>
  <div id="__dbgPanel" class="dbg-panel hidden">
    <div class="dbg-head">
      <b>로그</b>
      <div>
        <button id="__dbgCopy">복사</button>
        <button id="__dbgClear">지우기</button>
        <button id="__dbgClose">닫기</button>
      </div>
    </div>
    <textarea id="__dbgArea" readonly></textarea>
  </div>
</body>
</html>
